<!DOCTYPE html>
<html lang="en" style="min-height: 100%">
   <head>
      <meta charset="utf-8">
      <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
      <meta content="" name="description">
      <meta content="" name="author">
      <title>Plex Movie Downloader - User Info</title>
      <!-- Bootstrap core CSS -->
      <link href="vendor/bootstrap/css/bootstrap.css" rel="stylesheet">
      <!-- Custom styles for this template -->
      <link href="vendor/bootstrap/css/circle.css" rel="stylesheet">
      <link href="css/4-col-portfolio.css" rel="stylesheet">
      <script src='/socket.io/socket.io.js'></script>
      <script src='/scripts/cookies.js'></script>
      <script src='/scripts/media_data.js'></script>
      <script src='/scripts/helper_functions.js'></script>
      <script>
         function getParameterByName(name, url) {
             if (!url) url = window.location.href;
             name = name.replace(/[\[\]]/g, "\\$&");
             var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                 results = regex.exec(url);
             if (!results) return null;
             if (!results[2]) return '';
             return decodeURIComponent(results[2].replace(/\+/g, " "));
         }
         
         var socket = io();
         
         socket.on('user_info_res',function(data){
         console.log(data);
         document.getElementById('user_name').innerHTML = data.user_name+'\'s Profile';
         
         if(data.type=="Admin"){
           var admin_button = document.createElement("button");
           admin_button.classList.add("user_link");
           var admin_link = document.createElement("a");
            admin_link.innerHTML = "Admin Settings";
           admin_link.href = "admin";
           admin_button.appendChild(admin_link);
           document.getElementById("admin_button_placeholder").appendChild(admin_button);
         }

         document.getElementById("quota_limit_text").innerHTML = "Data Limit: "+data.quota_limit;
         document.getElementById("quota_current_text").innerHTML = "Used: "+data.quota;

         var quota_int = bytes_string_to_int(string_to_bytes(data.quota));
         var quota_limit_int = bytes_string_to_int(string_to_bytes(data.quota_limit));

         var quote_circle = document.getElementById("quota_circle"); 
         quote_circle.classList.remove('p0');
         quote_circle.classList.add('p'+Math.round(quota_int/quota_limit_int*100));
         document.getElementById('quota_inner').innerHTML = ((Math.round(quota_int/quota_limit_int*100)) || "0")+'%';
         console.log()
         });
      </script>
   </head>
   <body>
      <!-- Navigation -->
      <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
         <div class="container">
            <a class="navbar-brand" href="/home">Plex Movie Downloader</a> <button aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarResponsive" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
               <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                     <a class="nav-link" href="home">Home </a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href="movies">Movies</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href="tv_shows">TV Shows</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href="logout">Logout</a>
                  </li>
                  <li class="nav-item active">
                     <a class="nav-link" id="user_name" href="user_info"> <span class="sr-only">(current)</span></a>
                  </li>
                  <script>
                     socket.emit('user_info_req',{});
                  </script>           
               </ul>
            </div>
         </div>
         <a class="nav-link" href="https://app.plex.tv/desktop" id="plex_link">Watch PLEX</a>
      </nav>
      <!-- Page Content -->
      <div class="container info_page">
        <div class="info_page">
                   
            <div id="admin_button_placeholder" ></div>
            <div><button class="user_link" onclick="">Update Password</button></div>

         </div> 
         <div>
            <h2 id="quota_limit_text" class="my-4" style="text-align:center"></h2>
            <h2 id="quota_current_text" class="my-4" style="text-align:center"></h2>
            <div id="quota_circle" class="c100 p0 center orange dark">
               <span id="quota_inner"></span>
               <div class="slice">
                  <div class="bar"></div>
                  <div class="fill"></div>
               </div>
            </div>
         </div>
      </div>
      <!-- /.container -->
      <!-- Footer -->
      <script src="vendor/jquery/jquery.min.js"></script> 
      <script src="vendor/popper/popper.min.js"></script> 
      <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
   </body>
</html>